(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();class d{constructor(t){this.url=t}setAuthentication(t){this.authentication=t}buildHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.authentication.getToken()}`}}async logIn(t,o){return await(await fetch(`${this.url}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:o})})).json()}async fetchMe(){return await(await fetch(`${this.url}/me`,{method:"POST",headers:this.buildHeaders()})).json()}async updateInfo({secret:t,name:o}){return await(await fetch(`${this.url}/user`,{method:"PATCH",headers:this.buildHeaders(),body:JSON.stringify({secret:t,name:o})})).json()}async getUsers(t){const o=t?"?"+new URLSearchParams({search:t}).toString():"";return await(await fetch(`${this.url}/users${o}`,{method:"GET",headers:this.buildHeaders()})).json()}}class f{constructor(t){this.api=t,this.onNotAuthenticated=null,this.onAuthenticated=null}addEventListener(t,o){this[t]=o}redirectIfNotAuthenticated(){window.location.pathname.includes("/login")||(window.location.href="/login/")}redirectIfAuthenticated(){window.location.pathname.includes("/login")&&(window.location.href="/")}async fetchMe(){var r,e,n,s;if(!localStorage.getItem("token")){this.redirectIfNotAuthenticated();return}let o;try{if(o=await this.api.fetchMe(),!(o!=null&&o.user))return(r=this.onNotAuthenticated)==null||r.call(this),this.redirectIfNotAuthenticated()}catch(l){return console.log("error: ",l),(e=this.onNotAuthenticated)==null||e.call(this),this.redirectIfNotAuthenticated()}(n=this.onAuthenticated)==null||n.call(this,o),(s=this.redirectIfAuthenticated)==null||s.call(this)}async logIn(t,o){const{token:r}=await this.api.logIn(t,o);this.saveToken(r),this.fetchMe()}getToken(){return localStorage.getItem("token")}saveToken(t){localStorage.setItem("token",t)}}const u=["auth","api"],h=(i,t)=>{if(!u.includes(i))throw new Error("You can only store global objects in the document");document[i]=t},g=i=>{if(!u.includes(i))throw new Error("You can only store global objects in the document");return document[i]},p=window.location.hostname==="localhost"?"http://localhost:8080/api":"http://vps-e1b58ab7.vps.ovh.net/api",a=new d(p),c=new f(a);a.setAuthentication(c);c.fetchMe();h("auth",c);h("api",a);export{g};
