var f=Object.defineProperty;var p=(n,t,e)=>t in n?f(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var u=(n,t,e)=>p(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();class g{constructor(t){u(this,"url","http://localhost:8080/api");this.url=t}setAuthentication(t){this.authentication=t}buildHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.authentication.getToken()}`}}async logIn(t,e){return await(await fetch(`${this.url}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})})).json()}async fetchMe(){return await(await fetch(`${this.url}/me`,{method:"POST",headers:this.buildHeaders()})).json()}async updateInfo({secret:t,name:e}){return await(await fetch(`${this.url}/user`,{method:"PATCH",headers:this.buildHeaders(),body:JSON.stringify({secret:t,name:e})})).json()}async getUsers(t){const e=t?"?"+new URLSearchParams({search:t}).toString():"";return await(await fetch(`${this.url}/users${e}`,{method:"GET",headers:this.buildHeaders()})).json()}}class m{constructor(t){this.api=t,this.onNotAuthenticated=null,this.onAuthenticated=null}addEventListener(t,e){this[t]=e}redirectIfNotAuthenticated(){window.location.pathname.includes("/login")||(window.location.href="/login/")}redirectIfAuthenticated(){window.location.pathname.includes("/login")&&(window.location.href="/")}async fetchMe(){var i,o,r,s;if(!localStorage.getItem("token")){this.redirectIfNotAuthenticated();return}let e;try{if(e=await this.api.fetchMe(),!(e!=null&&e.user))return(i=this.onNotAuthenticated)==null||i.call(this),this.redirectIfNotAuthenticated()}catch(d){return console.log("error: ",d),(o=this.onNotAuthenticated)==null||o.call(this),this.redirectIfNotAuthenticated()}(r=this.onAuthenticated)==null||r.call(this,e),(s=this.redirectIfAuthenticated)==null||s.call(this)}async logIn(t,e){const{token:i}=await this.api.logIn(t,e);this.saveToken(i),this.fetchMe()}getToken(){return localStorage.getItem("token")}saveToken(t){localStorage.setItem("token",t)}}const h=["auth","api"],l=(n,t)=>{if(!h.includes(n))throw new Error("You can only store global objects in the document");document[n]=t},y=n=>{if(!h.includes(n))throw new Error("You can only store global objects in the document");return document[n]},a=new g("http://localhost:8080"),c=new m(a);a.setAuthentication(c);c.fetchMe();l("auth",c);l("api",a);export{y as g};
